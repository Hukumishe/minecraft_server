# Как подключиться к серверу Minecraft на Railway

## Пошаговая инструкция

### Шаг 1: Получение адреса сервера на Railway

После развертывания сервера на Railway:

1. **Откройте ваш проект на Railway** (https://railway.app)
2. **Выберите ваш сервис** (обычно называется `minecraft_server` или похожее)
3. **Перейдите в раздел "Settings"** (настройки)
4. **Найдите раздел "Networking"** или "Public Networking"

Здесь вы увидите:
- **Public Domain** (публичный домен) - например: `minecraft-server-production.up.railway.app`
- **Port** (порт) - может быть `25565` или другой номер

### Шаг 2: Настройка TCP Proxy (ОБЯЗАТЕЛЬНО для Minecraft!)

**КРИТИЧЕСКИ ВАЖНО:** Railway по умолчанию создает HTTP прокси, но Minecraft использует TCP протокол. Для Minecraft сервера **обязательно** нужно создать TCP Proxy!

1. В разделе **Settings → Networking**
2. Найдите кнопку **"+ TCP Proxy"** (внизу страницы)
3. Нажмите на неё
4. Railway создаст TCP прокси с новым доменом (например: `minecraftserver-production-tcp.up.railway.app`)
5. **Используйте этот TCP домен для подключения**, а не HTTP домен!

**Важно:** 
- Скрипт `start.sh` автоматически обновит `server.properties` с портом из переменной окружения `PORT`
- TCP Proxy автоматически перенаправляет трафик на правильный порт
- Для TCP Proxy обычно не нужно указывать порт в адресе Minecraft

### Шаг 3: Проверка статуса сервера

Перед подключением убедитесь, что сервер запущен:

1. В Railway перейдите в раздел **"Deployments"**
2. Выберите последний деплой
3. Проверьте статус - должен быть зеленый индикатор "Active" или "Running"
4. Откройте **"View Logs"** и убедитесь, что видите сообщение:
   ```
   Done (XX.XXXs)! For help, type help
   ```
   Это означает, что сервер полностью загрузился и готов к подключению.

### Шаг 4: Подключение в Minecraft

#### Вариант 1: Если порт 25565 (стандартный)

1. Откройте **Minecraft**
2. Нажмите **"Multiplayer"** (Сетевая игра)
3. Нажмите **"Add Server"** (Добавить сервер)
4. В поле **"Server Address"** (Адрес сервера) введите:
   ```
   ваш-домен.up.railway.app
   ```
   Например: `minecraft-server-production.up.railway.app`
5. Нажмите **"Done"** (Готово)
6. Сервер должен появиться в списке с зеленым индикатором
7. Нажмите на сервер и выберите **"Join Server"** (Присоединиться)

#### Вариант 2: Использование TCP Proxy (РЕКОМЕНДУЕТСЯ)

1. Откройте **Minecraft**
2. Нажмите **"Multiplayer"** (Сетевая игра)
3. Нажмите **"Add Server"** (Добавить сервер) или **"Edit"** (если сервер уже добавлен)
4. В поле **"Server Address"** (Адрес сервера) введите **TCP Proxy домен**:
   ```
   ваш-tcp-домен.up.railway.app
   ```
   Например: `minecraftserver-production-tcp.up.railway.app`
   - Обычно порт указывать не нужно для TCP Proxy
   - Railway автоматически перенаправит трафик
5. Нажмите **"Done"** (Готово)
6. Сервер должен появиться в списке
7. Нажмите на сервер и выберите **"Join Server"** (Присоединиться)

**Если TCP Proxy не создан:**
- Используйте HTTP домен с портом: `ваш-домен.up.railway.app:8080`
- Но лучше создать TCP Proxy для стабильной работы!

### Шаг 5: Проверка подключения

После нажатия "Join Server":
- Если все хорошо - вы попадете в игру на сервере
- Если видите ошибку - см. раздел "Решение проблем" ниже

## Как узнать точный адрес и порт

### Способ 1: Через интерфейс Railway

1. Откройте проект на Railway
2. Выберите сервис
3. Перейдите в **Settings → Networking**
4. Скопируйте **Public Domain**
5. Проверьте **Port** (если указан)

### Способ 2: Через логи Railway

1. Откройте **Deployments → View Logs**
2. Найдите строку с сообщением:
   ```
   Обновление порта сервера на XXXX (из переменной окружения Railway)
   ```
   Где `XXXX` - это ваш порт

### Способ 3: Через переменные окружения

1. В Railway: **Settings → Variables**
2. Найдите переменную `PORT` (Railway создает её автоматически)
3. Значение этой переменной - ваш порт

## Примеры адресов

```
# Стандартный порт 25565
minecraft-server-production.up.railway.app

# Или явно указать порт (работает в обоих случаях)
minecraft-server-production.up.railway.app:25565

# Нестандартный порт (например, 54321)
minecraft-server-production.up.railway.app:54321
```

## Решение проблем с подключением

### Проблема: "Can't resolve hostname" (Не удается разрешить имя хоста)

**Решение:**
- Проверьте правильность адреса (без опечаток)
- Убедитесь, что скопировали весь домен
- Попробуйте использовать IP-адрес (если Railway его предоставляет)

### Проблема: "Connection timed out" (Таймаут подключения)

**Решение:**
- Убедитесь, что сервер запущен (зеленый статус в Railway)
- Проверьте логи сервера - возможно, он еще загружается
- Подождите 1-2 минуты после запуска сервера
- Проверьте правильность порта

### Проблема: "Connection refused" (Подключение отклонено)

**Решение:**
- Сервер может быть не запущен - проверьте статус в Railway
- Проверьте логи на наличие ошибок
- Убедитесь, что порт указан правильно

### Проблема: Сервер не появляется в списке или показывает "Can't connect"

**Решение:**
1. **СОЗДАЙТЕ TCP PROXY!** Это самая частая причина проблемы
   - Railway → Settings → Networking → "+ TCP Proxy"
   - Используйте TCP домен вместо HTTP домена
2. Проверьте, что сервер полностью загрузился (см. логи)
3. Убедитесь, что используете правильную версию Minecraft
4. Проверьте настройки файрвола (Railway должен обрабатывать это автоматически)
5. Попробуйте перезапустить сервер в Railway
6. Удалите сервер из списка в Minecraft и добавьте заново с правильным адресом

### Проблема: "Outdated server!" или "Outdated client!"

**Решение:**
- Убедитесь, что версия Minecraft на клиенте совпадает с версией сервера
- Проверьте переменную `MINECRAFT_VERSION` на Railway
- Или проверьте, какая версия указана в кастомной сборке

## Проверка версии сервера

Чтобы узнать, какая версия Minecraft на сервере:

1. Откройте логи в Railway
2. Найдите строку при запуске, например:
   ```
   Starting minecraft server version 1.20.1
   ```
3. Установите такую же версию в вашем клиенте Minecraft

## Дополнительные советы

✅ **Сохраните адрес сервера** - добавьте его в закладки или запишите, чтобы не искать каждый раз

✅ **Используйте прямое подключение** - если домен не работает, Railway может предоставить IP-адрес

✅ **Проверяйте статус сервера** - если сервер остановился (из-за неактивности или исчерпания кредитов), перезапустите его в Railway

✅ **Мониторьте логи** - если возникают проблемы, логи помогут понять причину

## Быстрая проверка

Перед подключением убедитесь:
- [ ] Сервер развернут на Railway
- [ ] Статус сервера "Running" или "Active"
- [ ] В логах видно "Done! For help, type help"
- [ ] У вас есть публичный домен от Railway
- [ ] Вы знаете порт (или используете стандартный 25565)
- [ ] Версия Minecraft на клиенте совпадает с версией сервера

После этого можно подключаться!

