# Решение ошибки "Failed to fetch" при подключении к API

## Проблема

Веб-интерфейс не может подключиться к API серверу на `minecraftserver-production-f41c.up.railway.app:8080`.

## Причины

1. **Порт 8080 не доступен через HTTP домен Railway**
   - Railway HTTP домен проксирует только определенные порты
   - Порт 8080 может быть недоступен напрямую

2. **API сервер не запущен**
   - Проверьте логи сервера на Railway

3. **Неправильный URL**
   - HTTP домен может не поддерживать указание порта

## Решения

### Решение 1: Создать TCP Proxy для API (РЕКОМЕНДУЕТСЯ)

1. В Railway откройте ваш проект
2. Перейдите в **Settings → Networking**
3. Нажмите **"+ TCP Proxy"**
4. Укажите внутренний порт: **8080** (порт API сервера)
5. Railway создаст новый TCP Proxy, например: `gondola.proxy.rlwy.net:XXXXX`
6. Используйте этот адрес в веб-интерфейсе:
   ```
   http://gondola.proxy.rlwy.net:XXXXX/api
   ```

### Решение 2: Использовать переменную окружения PORT

Railway автоматически предоставляет переменную `PORT`. Можно настроить API сервер на использование этого порта:

1. В Railway: **Settings → Variables**
2. Добавьте переменную:
   - **Имя**: `API_PORT`
   - **Значение**: оставьте пустым или укажите порт
3. API сервер автоматически использует `PORT` от Railway

**Важно:** Если используете `PORT` для API, убедитесь, что Minecraft сервер использует другой порт (25565).

### Решение 3: Использовать HTTP домен без порта

Если Railway проксирует порт 8080 автоматически, попробуйте использовать HTTP домен без указания порта:

```
http://minecraftserver-production-f41c.up.railway.app/api
```

Или через HTTPS:
```
https://minecraftserver-production-f41c.up.railway.app/api
```

### Решение 4: Проверить, что API сервер запущен

1. В Railway откройте **Deployments → View Logs**
2. Найдите строку: `API сервер запущен на порту 8080`
3. Если этой строки нет, API сервер не запустился

**Причины, почему API может не запуститься:**
- Ошибка в коде Python
- Порт уже занят
- Не установлен Python

## Проверка подключения

### Через браузер

Откройте в браузере:
```
http://ваш-api-url/api/status
```

Должен вернуться JSON:
```json
{
  "running": true,
  "players_online": 0,
  "version": "1.21.11",
  "world_exists": true
}
```

### Через curl

```bash
curl http://ваш-api-url/api/status
```

## Настройка веб-интерфейса

В веб-интерфейсе на Lovable укажите правильный URL API:

```typescript
// Если используете TCP Proxy
const API_BASE_URL = 'http://gondola.proxy.rlwy.net:XXXXX/api';

// Или если используете HTTP домен
const API_BASE_URL = 'http://minecraftserver-production-f41c.up.railway.app/api';

// Или через HTTPS
const API_BASE_URL = 'https://minecraftserver-production-f41c.up.railway.app/api';
```

## Проверка CORS

CORS уже настроен в API сервере (`Access-Control-Allow-Origin: *`), но если проблемы остаются:

1. Проверьте, что запросы идут с правильного домена
2. Убедитесь, что используется правильный протокол (HTTP/HTTPS)
3. Проверьте консоль браузера на наличие CORS ошибок

## Быстрая диагностика

1. ✅ API сервер запущен? (проверьте логи)
2. ✅ Правильный URL? (TCP Proxy или HTTP домен)
3. ✅ Порт доступен? (8080 или PORT от Railway)
4. ✅ CORS настроен? (уже настроен в коде)
5. ✅ Сервер перезапущен после изменений?

## Рекомендуемое решение

**Создайте TCP Proxy для порта 8080:**
- Это самый надежный способ
- Работает стабильно
- Не зависит от HTTP проксирования Railway

После создания TCP Proxy обновите URL в веб-интерфейсе.

