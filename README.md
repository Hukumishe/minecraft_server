# Minecraft Server на Railway

Этот проект позволяет развернуть сервер Minecraft на платформе Railway для игры до 5 человек.

## Требования

- Аккаунт на [Railway](https://railway.app)
- Git (для загрузки проекта)

## Развертывание на Railway

### Шаг 1: Подготовка проекта

1. Убедитесь, что все файлы находятся в репозитории:
   - `Dockerfile`
   - `server.properties`
   - `eula.txt`
   - `railway.json`
   - `start.sh`

2. Закоммитьте изменения в Git:
   ```bash
   git add .
   git commit -m "Initial Minecraft server setup"
   ```

### Шаг 2: Создание проекта на Railway

1. Перейдите на [Railway](https://railway.app) и войдите в аккаунт
2. Нажмите "New Project"
3. Выберите "Deploy from GitHub repo" (если проект на GitHub) или "Empty Project"
4. Если выбрали "Empty Project":
   - Нажмите "New" → "GitHub Repo"
   - Выберите ваш репозиторий

### Шаг 3: Настройка переменных окружения

В настройках проекта Railway добавьте переменные окружения:

**Обязательно:**
- `MEMORY` - объем памяти для сервера (по умолчанию: `6G`)

**Для кастомных сборок (моды, плагины):**
- `CUSTOM_SERVER_URL` - прямой URL к файлу .jar кастомной сборки
  - Пример: `https://example.com/path/to/custom-server.jar`
  - Поддерживаются прямые ссылки с GitHub Releases, Dropbox, Google Drive и других хостингов
  - **Важно:** После указания URL перезапустите сервер - сборка скачается автоматически
  - **Для игроков:** См. файл `ЗАГРУЗКА_СБОРОК_ДЛЯ_ИГРОКОВ.md` - инструкция по подключению к серверу с модами

**Для стандартного сервера (если не используете кастомную сборку):**
- `MINECRAFT_VERSION` - версия Minecraft (по умолчанию: `latest`)

**Важно:** Если указан `CUSTOM_SERVER_URL`, стандартный сервер скачиваться не будет!

### Шаг 4: Настройка порта

Railway автоматически определит порт из Dockerfile (25565), но убедитесь, что:

1. В настройках сервиса Railway:
   - Порт должен быть настроен на `25565`
   - Railway автоматически создаст публичный URL

2. В `server.properties` порт уже настроен на `25565`

### Шаг 5: Получение адреса сервера

После развертывания:

1. Railway предоставит публичный URL (например: `your-project.up.railway.app`)
2. В настройках сервиса найдите порт, который Railway назначил
3. Используйте этот адрес и порт для подключения к серверу

**Важно:** Railway может назначить случайный порт. Проверьте переменную окружения `PORT` или настройки сервиса.

### Шаг 6: Подключение к серверу

В Minecraft:
1. Откройте игру
2. Выберите "Multiplayer"
3. Нажмите "Add Server"
4. Введите адрес: `your-project.up.railway.app:PORT` (замените на ваш адрес и порт)

## Настройка сервера

### Изменение настроек

Отредактируйте файл `server.properties` для изменения:
- Количества игроков (`max-players`)
- Режима игры (`gamemode`)
- Сложности (`difficulty`)
- И других параметров

После изменений перезапустите сервис на Railway.

### Белый список (Whitelist)

Чтобы ограничить доступ только определенным игрокам:

1. В `server.properties` установите:
   ```
   white-list=true
   enforce-whitelist=true
   ```

2. После запуска сервера добавьте игроков через консоль Railway или создайте файл `whitelist.json`

## Сохранение мира

**ВАЖНО:** По умолчанию данные в контейнере Railway не сохраняются при перезапуске. Чтобы мир не терялся:

1. В Railway: **Settings → Volumes** (или **Storage**)
2. Создайте новый Volume:
   - **Mount Path**: `/minecraft/world`
   - **Name**: `minecraft-world` (или любое другое)
3. После этого мир будет сохраняться автоматически

**Подробная инструкция:** см. файл `СОХРАНЕНИЕ_МИРА.md`

## Мониторинг и логи

- Логи сервера доступны в разделе "Deployments" → "View Logs" на Railway
- Вы можете видеть все сообщения сервера в реальном времени

## Стоимость

Railway предоставляет бесплатный план с ограничениями:
- $5 кредитов в месяц
- Сервер может быть приостановлен после неактивности

Для постоянной работы рекомендуется платный план.

## Обновление сервера

**Для стандартного сервера:**
1. Измените переменную окружения `MINECRAFT_VERSION` на Railway
2. Удалите `server.jar` из контейнера или перезапустите сервис (сервер скачается заново)

**Для кастомных сборок:**
1. Обновите URL в переменной окружения `CUSTOM_SERVER_URL`
2. Удалите `server.jar` из контейнера или перезапустите сервис (новая сборка скачается)

## Решение проблем

### Сервер не запускается
- Проверьте логи в Railway
- Убедитесь, что `eula.txt` содержит `eula=true`
- Проверьте, что достаточно памяти (увеличьте `MEMORY` до `2G`)

### Не могу подключиться
- Проверьте правильность адреса и порта
- Убедитесь, что сервер запущен (проверьте логи)
- Проверьте настройки файрвола в Railway

### Недостаточно памяти
- По умолчанию установлено `6G`, но можно увеличить через переменную `MEMORY`
- Учтите, что увеличение памяти может увеличить стоимость

### Проблемы с кастомной сборкой
- Убедитесь, что `CUSTOM_SERVER_URL` указывает на прямой URL к файлу .jar
- Проверьте, что файл доступен для скачивания (не требует авторизации)
- Убедитесь, что URL ведет именно к файлу, а не к странице загрузки

## Дополнительные ресурсы

- [Документация Railway](https://docs.railway.app)
- [Документация Minecraft Server](https://minecraft.wiki/w/Server)

